@base <http://id.vlaanderen.be/crab/> .
@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rml: <http://semweb.mmlab.be/ns/rml#>.
@prefix ql: <http://semweb.mmlab.be/ns/ql#>.
@prefix schema:  <http://schema.org/> .
@prefix org:  <http://www.w3.org/ns/org#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix skos:  <http://www.w3.org/2004/02/skos/core#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
@prefix vcard:  <http://www.w3.org/2006/vcard/ns#> .
@prefix oslo:  <http://purl.org/oslo/ns/localgov#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rov:  <http://www.w3.org/ns/regorg#> .
@prefix kbo:  <http://data.kbodata.be/def#> .
@prefix dcterms:  <http://purl.org/dc/terms/> .
@prefix locn:  <http://www.w3.org/ns/locn#> .
@prefix foaf:  <http://xmlns.com/foaf/0.1/> .
@prefix geo:  <http://www.opengis.net/ont/geosparql#> .
@prefix db: <http://dbpedia.org/ontology/> .
@prefix xkos:  <http://rdf-vocabulary.ddialliance.org/xkos#> .


<AdresMapping>
  a rr:TriplesMap;
  rr:logicalTable [ 
  rr:sqlQuery """
  SELECT a.AdresID, a.StraatID, a.Huisnummer, a.Busnummer, a.Postcode,
sn.Naam as straatnaam_nl, gn.Naam as gemeentenaam_nl
 FROM Adres a
 INNER JOIN Straat s on a.StraatID=s.StraatID
 INNER JOIN Straatnaam sn on s.StraatID=sn.StraatID
 INNER JOIN Gemeente g on s.GemeenteID=g.GemeenteID
 INNER JOIN Gemeentenaam gn on g.GemeenteID=gn.GemeenteID
WHERE sn.TaalISOCode = 'NLD'
AND gn.TaalISOCode = 'NLD'
  """ 
  ];
  rr:subjectMap [
    rr:template "http://id.vlaanderen.be/id/adres/{AdresID}";
    rr:class locn:Address
  ]
;
#  rr:predicateObjectMap [
#    rr:predicate geo:sfTouches;
#    rr:objectMap [
#    rr:parentTriplesMap <StraatMapping> ;
#    rr:joinCondition [
#       rr:child "StraatID";
#       rr:parent "StraatID"
#    ]
#   ]
#  ]
#  ;
rr:predicateObjectMap [
    rr:predicate geo:sfTouches;
    rr:objectMap [
    rr:template "http://id.vlaanderen.be/id/straat/{StraatID}"
   ]
  ]
;  
rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
    rr:template "{straatnaam_nl} {Huisnummer}, {Postcode} {gemeentenaam_nl}";
    rr:termType rr:Literal
    ]
   ]
 ; 
  rr:predicateObjectMap [
    rr:predicate dcterms:identifier;
    rr:objectMap [
    rr:column "AdresID"
    ]
   ]
 ; 
 rr:predicateObjectMap [
    rr:predicate locn:locatorDesignator;
    rr:objectMap [
    rr:column "Huisnummer"
    ]
   ]
 ;  
 rr:predicateObjectMap [
    rr:predicate locn:postCode;
    rr:objectMap [
    rr:column "Postcode"
    ]
   ]
 ;  
  rr:predicateObjectMap [
    rr:predicate locn:postName;
    rr:objectMap [
    rr:column "gemeentenaam_nl";
    rr:language "nl"
    ]
   ]
 ;  
 rr:predicateObjectMap [
    rr:predicate locn:thoroughfare;
    rr:objectMap [
    rr:column "straatnaam_nl";
    rr:language "nl"
    ]
   ]
 ;  
  
 .

  <StraatMapping>
  a rr:TriplesMap;
  rr:logicalTable [ 
  rr:sqlQuery """
  SELECT s.StraatID, sn.Naam as straatnaam_nl, gn.Naam as gemeentenaam_nl
 FROM Straat s
 INNER JOIN Straatnaam sn on s.StraatID=sn.StraatID
 INNER JOIN Gemeente g on s.GemeenteID=g.GemeenteID
 INNER JOIN Gemeentenaam gn on g.GemeenteID=gn.GemeenteID
WHERE sn.TaalISOCode = 'NLD'
AND gn.TaalISOCode = 'NLD'
  """ 
  ];
  rr:subjectMap [
    rr:template "http://id.vlaanderen.be/id/straat/{StraatID}";
    rr:class db:Street
  ]
;
 rr:predicateObjectMap [
    rr:predicate dcterms:identifier;
    rr:objectMap [
    rr:column "StraatID"
    ]
   ]
 ; 
 # rr:predicateObjectMap [
 #   rr:predicate geo:sfWithin;
 #   rr:objectMap [
 #   rr:parentTriplesMap <GemeenteMapping> ;
 #   rr:joinCondition [
 #      rr:child "GemeenteID";
 #     rr:parent "GemeenteID"
 #   ]
 #  ]
 # ]
 # ;
 # ;
rr:predicateObjectMap [
    rr:predicate geo:sfWithin;
    rr:objectMap [
    rr:template "http://id.vlaanderen.be/id/gemeente/{GemeenteID}"
   ]
  ]
;  

  rr:predicateObjectMap [
    rr:predicate locn:postName;
    rr:objectMap [
    rr:column "gemeentenaam_nl";
    rr:language "nl"
    ]
   ]
 ; 

 rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
    rr:template "{straatnaam_nl}, {gemeentenaam_nl}";
    rr:termType rr:Literal
    ]
   ]
 ;    
 .


   <GemeenteMapping>
  a rr:TriplesMap;
  rr:logicalTable [ rr:sqlQuery  """
  SELECT g.GemeenteID as GemeenteID, g.NIScode as NIS, gn.Naam as gemeentenaam_nl
 FROM Gemeente g
 INNER JOIN Gemeentenaam gn on g.GemeenteID=gn.GemeenteID
WHERE gn.TaalISOCode = 'NLD'
  """ 
  ];
  rr:subjectMap [
    rr:template "http://id.vlaanderen.be/id/gemeente/{GemeenteID}";
    rr:class db:City
  ]
;
 rr:predicateObjectMap [
    rr:predicate dcterms:identifier;
    rr:objectMap [
    rr:column "GemeenteID"
    ]
   ]
 ;
 rr:predicateObjectMap [
    rr:predicate xkos:classifiedUnder  ;
    rr:objectMap [
    rr:template "http://id.fedstats.be/nis/{NIS}#id"
    ]
   ]
 ; 
 rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
    rr:column "gemeentenaam_nl";
    rr:language "nl"
    ]
   ]
 ;    
 .
 



