@base <http://id.vlaanderen.be/crab/> .
@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix rml: <http://semweb.mmlab.be/ns/rml#>.
@prefix ql: <http://semweb.mmlab.be/ns/ql#>.
@prefix schema:  <http://schema.org/> .
@prefix org:  <http://www.w3.org/ns/org#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix skos:  <http://www.w3.org/2004/02/skos/core#> .
@prefix rdfs:  <http://www.w3.org/2000/01/rdf-schema#> .
@prefix vcard:  <http://www.w3.org/2006/vcard/ns#> .
@prefix oslo:  <http://purl.org/oslo/ns/localgov#> .
@prefix rdf:  <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rov:  <http://www.w3.org/ns/regorg#> .
@prefix kbo:  <http://data.kbodata.be/def#> .
@prefix dcterms:  <http://purl.org/dc/terms/> .
@prefix locn:  <http://www.w3.org/ns/locn#> .
@prefix foaf:  <http://xmlns.com/foaf/0.1/> .
@prefix geo:  <http://www.opengis.net/ont/geosparql#> .
@prefix db: <http://dbpedia.org/ontology/> .
@prefix xkos:  <http://rdf-vocabulary.ddialliance.org/xkos#> .
@prefix wkt:  <http://rdf-vocabulary.ddialliance.org/xkos#> .


<AdresMapping>
  a rr:TriplesMap;
  rr:logicalTable [ 
  rr:sqlQuery """SELECT a.AdresID, a.StraatID, a.Huisnummer, a.Busnummer, a.Postcode, a.Positie,
sn.Naam as straatnaam_nl, gn.Naam as gemeentenaam_nl
FROM Adres a
INNER JOIN Straat s on a.StraatID=s.StraatID
INNER JOIN Straatnaam sn on s.StraatID=sn.StraatID
INNER JOIN Gemeente g on s.GemeenteID=g.GemeenteID
INNER JOIN Gemeentenaam gn on g.GemeenteID=gn.GemeenteID
WHERE sn.TaalISOCode = 'NLD'
AND gn.TaalISOCode = 'NLD'""" 
  ];
  rr:subjectMap [
    rr:template "http://id.vlaanderen.be/id/adres/{AdresID}";
    rr:class locn:Address
  ]
;
#  rr:predicateObjectMap [
#    rr:predicate geo:sfTouches;
#    rr:objectMap [
#    rr:parentTriplesMap <StraatMapping> ;
#    rr:joinCondition [
#       rr:child "StraatID";
#       rr:parent "StraatID"
#    ]
#   ]
#  ]
#  ;
rr:predicateObjectMap [
    rr:predicate geo:sfTouches;
    rr:objectMap [
    rr:template "http://id.vlaanderen.be/id/straat/{StraatID}"
   ]
  ]
;  
rr:predicateObjectMap [
    rr:predicate rdfs:label;
    rr:objectMap [
    rr:template "{straatnaam_nl} {Huisnummer}, {Postcode} {gemeentenaam_nl}";
    rr:termType rr:Literal
    ]
   ]
 ; 
  rr:predicateObjectMap [
    rr:predicate dcterms:identifier;
    rr:objectMap [
    rr:column "AdresID";
    rr:datatype xsd:integer
    ]
   ]
 ; 
 rr:predicateObjectMap [
    rr:predicate locn:locatorDesignator;
    rr:objectMap [
    rr:column "Huisnummer"
    ]
   ]
 ;  
 rr:predicateObjectMap [
    rr:predicate locn:postCode;
    rr:objectMap [
    rr:column "Postcode"
    ]
   ]
 ;  
  rr:predicateObjectMap [
    rr:predicate locn:postName;
    rr:objectMap [
    rr:column "gemeentenaam_nl";
    rr:language "nl"
    ]
   ]
 ;  
 rr:predicateObjectMap [
    rr:predicate locn:thoroughfare;
    rr:objectMap [
    rr:column "straatnaam_nl";
    rr:language "nl"
    ]
   ]
 ;  

 rr:predicateObjectMap [
    rr:predicate geo:hasGeometry;
    rr:objectMap [
    rr:template "http://id.vlaanderen.be/id/geometry/adres/{AdresID}";

    ]
   ]
 ; 
 
 .

 <GeoMapping>
  a rr:TriplesMap;
  rr:logicalTable [ 
 rr:sqlQuery """SELECT a.AdresID, aps.Omschrijving as Specificatie, apm.Omschrijving as Methode, ads.Omschrijving as Status
FROM Adres a
INNER JOIN AdresPositieSpecificatie aps on aps.AdresPositieSpecificatieID=a.AdresPositieSpecificatieID
INNER JOIN AdresPositieMethode apm on apm.AdresPositieMethodeID=a.AdresPositieMethodeID
INNER JOIN AdresStatus ads on ads.AdresstatusID=a.AdresStatusID
"""
  ];
  rr:subjectMap [
    rr:template "http://id.vlaanderen.be/id/geometry/adres/{AdresID}";
    rr:class geo:Geometry
  ]
;
rr:predicateObjectMap [
    rr:predicate geo:asWKT;
    rr:objectMap [
    rr:column "Positie";
    rr:datatype geo:wktLiteral
    ]
   ]
 ; 
 rr:predicateObjectMap [
    rr:predicate <http://id.vlaanderen.be/ns/geo#adresPositieSpecificatie>;
    rr:objectMap [
    rr:column "Specificatie";
    ]
   ]
 ; 
 rr:predicateObjectMap [
    rr:predicate <http://id.vlaanderen.be/ns/geo#adresPositieMethode>;
    rr:objectMap [
    rr:column "Methode";
    ]
   ]
 ; 
 rr:predicateObjectMap [
    rr:predicate <http://id.vlaanderen.be/ns/geo#adresStatus>;
    rr:objectMap [
    rr:column "Status";
    ]
   ]
 ; 
 .


 


